<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIOMA Uberaba v4.5 - Sistema de Gestão</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Tema Claro */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --primary: #7C3AED;
            --primary-hover: #6d28d9;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
        }

        [data-theme="dark"] {
            /* Tema Escuro */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #6366f1 100%);
            padding: 20px;
        }

        .login-box {
            background: var(--bg-primary);
            padding: 40px;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: block;
            border-radius: 50%;
            object-fit: cover;
        }

        .login-title {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-primary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Main App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-container.active {
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: cover;
        }

        .sidebar-brand {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .sidebar-version {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 12px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }

        .menu-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .menu-item.active {
            background: var(--primary);
            color: white;
        }

        .menu-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 40px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: var(--bg-tertiary);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-category {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .search-title {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .search-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: var(--primary);
            color: white;
        }

        /* Content Area */
        .content {
            padding: 32px;
            flex: 1;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .stat-card.primary::before { background: var(--primary); }
        .stat-card.success::before { background: var(--success); }
        .stat-card.danger::before { background: var(--danger); }
        .stat-card.warning::before { background: var(--warning); }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            font-size: 14px;
            color: var(--text-primary);
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        /* Form Layout */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .autocomplete-container {
            position: relative;
        }

        .autocomplete-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }

        .autocomplete-results.active {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .autocomplete-item:hover {
            background: var(--bg-tertiary);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        /* Items Table for Orçamento */
        .items-table {
            margin: 20px 0;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 80px;
            gap: 12px;
            align-items: center;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .item-row input,
        .item-row select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .btn-remove {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-footer {
            margin-top: 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Alert */
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.active {
            display: block;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--info);
            color: var(--info);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
        }

        .file-upload input {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Calendar Styles */
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        .calendar-day.has-appointment {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--primary);
        }

        .calendar-day-number {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .calendar-appointment-count {
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: var(--primary);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                width: 280px;
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .item-row {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .top-bar,
            .btn {
                display: none !important;
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <img id="loginLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%237C3AED'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='white' font-size='32' font-weight='bold'%3EB%3C/text%3E%3C/svg%3E" alt="Logo" class="login-logo">
            <h1 class="login-title">BIOMA Uberaba</h1>
            <p class="login-subtitle">Sistema de Gestão v4.5</p>

            <div id="loginAlert" class="alert"></div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Usuário</label>
                    <input type="text" class="form-input" id="loginUsername" required placeholder="Digite seu usuário">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-input" id="loginPassword" required placeholder="Digite sua senha">
                </div>
                <button type="submit" class="btn btn-primary">
                    <span>Entrar</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo-container">
                    <img id="sidebarLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Ccircle cx='24' cy='24' r='24' fill='%237C3AED'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='white' font-size='20' font-weight='bold'%3EB%3C/text%3E%3C/svg%3E" alt="Logo" class="sidebar-logo">
                    <div>
                        <div class="sidebar-brand">BIOMA</div>
                        <div class="sidebar-version">v4.5 Ultra</div>
                    </div>
                </div>
            </div>

            <nav class="sidebar-menu">
                <div class="menu-item active" onclick="navigateTo('dashboard')">
                    <span class="menu-icon">📊</span>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" onclick="navigateTo('orcamentos')">
                    <span class="menu-icon">💰</span>
                    <span>Orçamentos</span>
                </div>
                <div class="menu-item" onclick="navigateTo('clientes')">
                    <span class="menu-icon">👥</span>
                    <span>Clientes</span>
                </div>
                <div class="menu-item" onclick="navigateTo('servicos')">
                    <span class="menu-icon">✨</span>
                    <span>Serviços</span>
                </div>
                <div class="menu-item" onclick="navigateTo('produtos')">
                    <span class="menu-icon">📦</span>
                    <span>Produtos</span>
                </div>
                <div class="menu-item" onclick="navigateTo('profissionais')">
                    <span class="menu-icon">👨‍💼</span>
                    <span>Profissionais</span>
                </div>
                <div class="menu-item" onclick="navigateTo('estoque')">
                    <span class="menu-icon">📋</span>
                    <span>Estoque</span>
                </div>
                <div class="menu-item" onclick="navigateTo('agendamentos')">
                    <span class="menu-icon">📅</span>
                    <span>Agendamentos</span>
                </div>
                <div class="menu-item" onclick="navigateTo('relatorios')">
                    <span class="menu-icon">📈</span>
                    <span>Relatórios</span>
                </div>
                <div class="menu-item" onclick="navigateTo('configuracoes')">
                    <span class="menu-icon">⚙️</span>
                    <span>Configurações</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Usuário</div>
                        <div class="user-role" id="userRole">Admin</div>
                    </div>
                </div>
                <button class="btn btn-secondary" style="width: 100%;" onclick="handleLogout()">Sair</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="search-input" id="globalSearch" placeholder="Buscar em tudo... (clientes, produtos, serviços, profissionais, orçamentos)" oninput="handleGlobalSearch(this.value)">
                    <div class="search-results" id="searchResults"></div>
                </div>

                <div class="top-bar-actions">
                    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</button>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Section -->
                <section id="section-dashboard" class="section active">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-subtitle">Visão geral do seu negócio</p>
                    </div>

                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card primary">
                            <div class="stat-label">Faturamento do Mês</div>
                            <div class="stat-value" id="statFaturamento">R$ 0,00</div>
                            <div class="stat-change positive" id="statFaturamentoChange">+0%</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Orçamentos Aprovados</div>
                            <div class="stat-value" id="statOrcamentos">0</div>
                            <div class="stat-change positive" id="statOrcamentosChange">+0%</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Clientes Ativos</div>
                            <div class="stat-value" id="statClientes">0</div>
                            <div class="stat-change positive" id="statClientesChange">+0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Produtos em Estoque</div>
                            <div class="stat-value" id="statProdutos">0</div>
                            <div class="stat-change" id="statProdutosChange">0 itens</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Orçamentos Recentes</h3>
                                <p class="card-subtitle">Últimas movimentações</p>
                            </div>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Número</th>
                                        <th>Cliente</th>
                                        <th>Data</th>
                                        <th>Valor</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="recentOrcamentosTable">
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                            <p style="color: var(--text-secondary); margin-top: 12px;">Carregando...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Orçamentos Section -->
                <section id="section-orcamentos" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Orçamentos</h1>
                        <p class="page-subtitle">Gerencie orçamentos e contratos</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Novo Orçamento</h3>
                                <p class="card-subtitle">Preencha os dados para criar um orçamento</p>
                            </div>
                            <button class="btn btn-primary" onclick="openModal('novoOrcamentoModal')">+ Novo Orçamento</button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Número</th>
                                        <th>Cliente</th>
                                        <th>Data</th>
                                        <th>Valor Total</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="orcamentosTable">
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Clientes Section -->
                <section id="section-clientes" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Clientes</h1>
                        <p class="page-subtitle">Gerencie sua base de clientes</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Lista de Clientes</h3>
                            </div>
                            <button class="btn btn-primary" onclick="openModal('novoClienteModal')">+ Novo Cliente</button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>CPF</th>
                                        <th>Telefone</th>
                                        <th>Email</th>
                                        <th>Cidade</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="clientesTable">
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Serviços Section -->
                <section id="section-servicos" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Serviços</h1>
                        <p class="page-subtitle">Catálogo de serviços oferecidos</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Lista de Serviços</h3>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-secondary" onclick="openModal('importarServicosModal')">📥 Importar Excel</button>
                                <button class="btn btn-primary" onclick="openModal('novoServicoModal')">+ Novo Serviço</button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Categoria</th>
                                        <th>Tamanho PP</th>
                                        <th>Tamanho P</th>
                                        <th>Tamanho M</th>
                                        <th>Tamanho G</th>
                                        <th>Tamanho GG</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="servicosTable">
                                    <tr>
                                        <td colspan="8" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Produtos Section -->
                <section id="section-produtos" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Produtos</h1>
                        <p class="page-subtitle">Catálogo de produtos</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Lista de Produtos</h3>
                            </div>
                            <button class="btn btn-primary" onclick="openModal('novoProdutoModal')">+ Novo Produto</button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>SKU</th>
                                        <th>Nome</th>
                                        <th>Marca</th>
                                        <th>Categoria</th>
                                        <th>Preço</th>
                                        <th>Estoque</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="produtosTable">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Profissionais Section -->
                <section id="section-profissionais" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Profissionais</h1>
                        <p class="page-subtitle">Equipe e comissões</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Lista de Profissionais</h3>
                            </div>
                            <button class="btn btn-primary" onclick="openModal('novoProfissionalModal')">+ Novo Profissional</button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Foto</th>
                                        <th>Nome</th>
                                        <th>CPF</th>
                                        <th>Cargo</th>
                                        <th>Comissão (%)</th>
                                        <th>Assistente</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="profissionaisTable">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Estoque Section -->
                <section id="section-estoque" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Estoque</h1>
                        <p class="page-subtitle">Controle de movimentações</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Movimentações de Estoque</h3>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-success" onclick="aprovarTodasMovimentacoes()">✓ Aprovar Todas</button>
                                <button class="btn btn-danger" onclick="reprovarTodasMovimentacoes()">✗ Reprovar Todas</button>
                                <button class="btn btn-primary" onclick="openModal('novaMovimentacaoModal')">+ Nova Movimentação</button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Produto</th>
                                        <th>Tipo</th>
                                        <th>Quantidade</th>
                                        <th>Responsável</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="estoqueTable">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px;">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Agendamentos Section -->
                <section id="section-agendamentos" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Agendamentos</h1>
                        <p class="page-subtitle">Calendário e disponibilidade</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Calendário de Agendamentos</h3>
                            </div>
                            <button class="btn btn-primary" onclick="openModal('novoAgendamentoModal')">+ Novo Agendamento</button>
                        </div>

                        <div id="calendarContainer" style="padding: 20px;">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </section>

                <!-- Relatórios Section -->
                <section id="section-relatorios" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Relatórios</h1>
                        <p class="page-subtitle">Análises e estatísticas</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Gerar Relatórios</h3>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tipo de Relatório</label>
                                <select class="form-input" id="relatorioTipo">
                                    <option value="vendas">Vendas</option>
                                    <option value="estoque">Estoque</option>
                                    <option value="comissoes">Comissões</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data Inicial</label>
                                <input type="date" class="form-input" id="relatorioDataInicio">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data Final</label>
                                <input type="date" class="form-input" id="relatorioDataFim">
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="gerarRelatorioPDF()">📄 Gerar PDF</button>
                            <button class="btn btn-success" onclick="gerarRelatorioExcel()">📊 Gerar Excel</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Estatísticas Detalhadas</h3>
                        </div>
                        <div id="estatisticasContainer">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </section>

                <!-- Configurações Section -->
                <section id="section-configuracoes" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Configurações</h1>
                        <p class="page-subtitle">Personalize o sistema</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Logo da Empresa</h3>
                        </div>

                        <div class="file-upload" onclick="document.getElementById('logoUpload').click()">
                            <div class="upload-icon">📷</div>
                            <div class="upload-text">Clique para fazer upload do logo</div>
                            <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)">
                        </div>

                        <div id="currentLogo" style="margin-top: 20px; text-align: center;"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Backup e Restauração</h3>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary" onclick="fazerBackup()">💾 Fazer Backup</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('restoreFile').click()">📥 Restaurar Backup</button>
                            <input type="file" id="restoreFile" accept=".zip" style="display: none;" onchange="restaurarBackup(event)">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Preferências</h3>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="autoApprove" onchange="salvarPreferencias()">
                                Aprovar movimentações de estoque automaticamente
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="emailNotifications" onchange="salvarPreferencias()">
                                Receber notificações por email
                            </label>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Modal: Novo Orçamento -->
    <div id="novoOrcamentoModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">Novo Orçamento</h2>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">CPF do Cliente</label>
                    <div class="autocomplete-container">
                        <input type="text" class="form-input" id="orcClienteCPF" placeholder="Digite o CPF" oninput="buscarClientePorCPF(this.value)">
                        <div class="autocomplete-results" id="clienteAutocomplete"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Nome do Cliente</label>
                    <input type="text" class="form-input" id="orcClienteNome" readonly>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Profissional</label>
                    <select class="form-input" id="orcProfissional"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Assistente (opcional)</label>
                    <select class="form-input" id="orcAssistente">
                        <option value="">Nenhum</option>
                    </select>
                </div>
            </div>

            <h4 style="margin: 20px 0;">Serviços e Produtos</h4>

            <div class="autocomplete-container" style="margin-bottom: 16px;">
                <input type="text" class="form-input" id="itemSearch" placeholder="🔍 Digite para buscar serviços ou produtos..." oninput="buscarItens(this.value)">
                <div class="autocomplete-results" id="itemAutocomplete"></div>
            </div>

            <div id="orcamentoItems"></div>

            <button class="btn btn-secondary" onclick="adicionarItemManual()" style="margin-top: 12px;">+ Adicionar Item Manual</button>

            <div class="form-row" style="margin-top: 24px;">
                <div class="form-group">
                    <label class="form-label">Desconto Global (%)</label>
                    <input type="number" class="form-input" id="orcDescontoGlobal" value="0" min="0" max="100" oninput="calcularTotalOrcamento()">
                </div>
                <div class="form-group">
                    <label class="form-label">Forma de Pagamento</label>
                    <select class="form-input" id="orcFormaPagamento">
                        <option value="pix">PIX</option>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="debito">Cartão Débito</option>
                        <option value="credito">Cartão Crédito</option>
                    </select>
                </div>
            </div>

            <div style="margin-top: 24px; padding: 20px; background: var(--bg-tertiary); border-radius: 8px;">
                <h3 style="font-size: 24px; color: var(--primary);">Total: <span id="orcTotal">R$ 0,00</span></h3>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">
                    Comissão Profissional: <span id="orcComissaoProfissional">R$ 0,00</span> | 
                    Comissão Assistente: <span id="orcComissaoAssistente">R$ 0,00</span>
                </p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novoOrcamentoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarOrcamento()">Salvar Orçamento</button>
            </div>
        </div>
    </div>

    <!-- Modal: Novo Cliente -->
    <div id="novoClienteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Cliente</h2>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nome Completo *</label>
                    <input type="text" class="form-input" id="clienteNome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">CPF *</label>
                    <input type="text" class="form-input" id="clienteCPF" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="clienteEmail">
                </div>
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="text" class="form-input" id="clienteTelefone">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">CEP</label>
                    <input type="text" class="form-input" id="clienteCEP" oninput="buscarCEP(this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">Cidade</label>
                    <input type="text" class="form-input" id="clienteCidade">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Endereço</label>
                <input type="text" class="form-input" id="clienteEndereco">
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novoClienteModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarCliente()">Salvar Cliente</button>
            </div>
        </div>
    </div>

    <!-- Modal: Novo Serviço -->
    <div id="novoServicoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Serviço</h2>
            </div>

            <div class="form-group">
                <label class="form-label">Nome do Serviço *</label>
                <input type="text" class="form-input" id="servicoNome" required>
            </div>

            <div class="form-group">
                <label class="form-label">Categoria</label>
                <input type="text" class="form-input" id="servicoCategoria">
            </div>

            <h4 style="margin: 20px 0;">Preços por Tamanho</h4>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">PP (Pequeno)</label>
                    <input type="number" class="form-input" id="servicoPP" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">P (Pequeno)</label>
                    <input type="number" class="form-input" id="servicoP" step="0.01" placeholder="0.00">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">M (Médio)</label>
                    <input type="number" class="form-input" id="servicoM" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">G (Grande)</label>
                    <input type="number" class="form-input" id="servicoG" step="0.01" placeholder="0.00">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">GG (Extra Grande)</label>
                <input type="number" class="form-input" id="servicoGG" step="0.01" placeholder="0.00">
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novoServicoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarServico()">Salvar Serviço</button>
            </div>
        </div>
    </div>

    <!-- Modal: Importar Serviços -->
    <div id="importarServicosModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Importar Serviços (Excel)</h2>
            </div>

            <div class="alert alert-info active">
                <p><strong>Formato esperado:</strong></p>
                <p>Colunas: Nome | Categoria | PP | P | M | G | GG</p>
            </div>

            <div class="file-upload" onclick="document.getElementById('servicosExcel').click()">
                <div class="upload-icon">📊</div>
                <div class="upload-text">Clique para fazer upload do arquivo Excel</div>
                <input type="file" id="servicosExcel" accept=".xlsx,.xls" onchange="importarServicos(event)">
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('importarServicosModal')">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Novo Produto -->
    <div id="novoProdutoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Produto</h2>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">SKU *</label>
                    <input type="text" class="form-input" id="produtoSKU" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Nome *</label>
                    <input type="text" class="form-input" id="produtoNome" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Marca</label>
                    <input type="text" class="form-input" id="produtoMarca">
                </div>
                <div class="form-group">
                    <label class="form-label">Categoria</label>
                    <input type="text" class="form-input" id="produtoCategoria">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Preço *</label>
                    <input type="number" class="form-input" id="produtoPreco" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Estoque Inicial</label>
                    <input type="number" class="form-input" id="produtoEstoque" value="0">
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novoProdutoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarProduto()">Salvar Produto</button>
            </div>
        </div>
    </div>

    <!-- Modal: Novo Profissional -->
    <div id="novoProfissionalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Profissional</h2>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nome Completo *</label>
                    <input type="text" class="form-input" id="profissionalNome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">CPF *</label>
                    <input type="text" class="form-input" id="profissionalCPF" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Cargo</label>
                    <input type="text" class="form-input" id="profissionalCargo">
                </div>
                <div class="form-group">
                    <label class="form-label">Comissão (%)</label>
                    <input type="number" class="form-input" id="profissionalComissao" step="0.01" value="10">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Foto do Profissional</label>
                <input type="file" class="form-input" id="profissionalFoto" accept="image/*">
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novoProfissionalModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarProfissional()">Salvar Profissional</button>
            </div>
        </div>
    </div>

    <!-- Modal: Nova Movimentação -->
    <div id="novaMovimentacaoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Movimentação de Estoque</h2>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Produto *</label>
                    <select class="form-input" id="movProduto" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo *</label>
                    <select class="form-input" id="movTipo" required>
                        <option value="entrada">Entrada</option>
                        <option value="saida">Saída</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Quantidade *</label>
                    <input type="number" class="form-input" id="movQuantidade" required min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Responsável</label>
                    <input type="text" class="form-input" id="movResponsavel">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Observações</label>
                <textarea class="form-input" id="movObservacoes" rows="3"></textarea>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novaMovimentacaoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarMovimentacao()">Salvar Movimentação</button>
            </div>
        </div>
    </div>

    <!-- Modal: Novo Agendamento -->
    <div id="novoAgendamentoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Agendamento</h2>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select class="form-input" id="agendCliente" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Profissional *</label>
                    <select class="form-input" id="agendProfissional" required></select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Data *</label>
                    <input type="date" class="form-input" id="agendData" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Horário *</label>
                    <input type="time" class="form-input" id="agendHorario" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Serviço/Descrição *</label>
                <textarea class="form-input" id="agendDescricao" rows="3" required></textarea>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('novoAgendamentoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarAgendamento()">Salvar Agendamento</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURAÇÃO DA API
        // ========================================
        const API_URL = window.location.origin;

        // ========================================
        // ESTADO GLOBAL
        // ========================================
        let currentUser = null;
        let orcamentoItems = [];
        let allClientes = [];
        let allServicos = [];
        let allProdutos = [];
        let allProfissionais = [];

        // ========================================
        // FUNÇÕES DE AUTENTICAÇÃO
        // ========================================
        async function handleLogin(event) {
            event.preventDefault();
            showLoading();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    showApp();
                    loadDashboard();
                } else {
                    showAlert('loginAlert', data.message, 'error');
                }
            } catch (error) {
                console.error('Erro no login:', error);
                showAlert('loginAlert', 'Erro ao conectar com o servidor', 'error');
            } finally {
                hideLoading();
            }
        }

        async function handleLogout() {
            if (!confirm('Deseja realmente sair?')) return;

            try {
                await fetch(`${API_URL}/api/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
            } catch (error) {
                console.error('Erro no logout:', error);
            }

            currentUser = null;
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('loginForm').reset();
        }

        function showApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');

            // Atualizar informações do usuário
            const avatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');

            if (currentUser) {
                avatar.textContent = currentUser.username.charAt(0).toUpperCase();
                userName.textContent = currentUser.username;
                userRole.textContent = currentUser.role || 'Admin';
            }

            // Carregar logo se existir
            loadLogo();
        }

        // ========================================
        // NAVEGAÇÃO
        // ========================================
        function navigateTo(section) {
            // Remover active de todos os menus e seções
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });

            // Ativar menu e seção selecionados
            event.target.closest('.menu-item').classList.add('active');
            document.getElementById(`section-${section}`).classList.add('active');

            // Carregar dados da seção
            loadSectionData(section);
        }

        async function loadSectionData(section) {
            switch(section) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'orcamentos':
                    await loadOrcamentos();
                    break;
                case 'clientes':
                    await loadClientes();
                    break;
                case 'servicos':
                    await loadServicos();
                    break;
                case 'produtos':
                    await loadProdutos();
                    break;
                case 'profissionais':
                    await loadProfissionais();
                    break;
                case 'estoque':
                    await loadEstoque();
                    break;
                case 'agendamentos':
                    await loadAgendamentos();
                    break;
                case 'relatorios':
                    await loadRelatorios();
                    break;
                case 'configuracoes':
                    await loadConfiguracoes();
                    break;
            }
        }

        // ========================================
        // DASHBOARD
        // ========================================
        async function loadDashboard() {
            try {
                const response = await fetch(`${API_URL}/api/dashboard/stats`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    const stats = data.stats;

                    // Atualizar estatísticas
                    document.getElementById('statFaturamento').textContent = `R$ ${stats.faturamento_mes?.toFixed(2) || '0,00'}`;
                    document.getElementById('statOrcamentos').textContent = stats.orcamentos_aprovados || 0;
                    document.getElementById('statClientes').textContent = stats.total_clientes || 0;
                    document.getElementById('statProdutos').textContent = stats.total_produtos || 0;
                }

                // Carregar orçamentos recentes
                await loadRecentOrcamentos();
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        async function loadRecentOrcamentos() {
            try {
                const response = await fetch(`${API_URL}/api/orcamentos?limit=10`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    renderOrcamentosTable('recentOrcamentosTable', data.orcamentos.slice(0, 5));
                }
            } catch (error) {
                console.error('Erro ao carregar orçamentos:', error);
            }
        }

        function renderOrcamentosTable(tableId, orcamentos) {
            const tbody = document.getElementById(tableId);

            if (!orcamentos || orcamentos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum orçamento encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = orcamentos.map(orc => `
                <tr>
                    <td><strong>#${orc.numero || '-'}</strong></td>
                    <td>${orc.cliente_nome || '-'}</td>
                    <td>${new Date(orc.data).toLocaleDateString('pt-BR')}</td>
                    <td><strong>R$ ${(orc.valor_total || 0).toFixed(2)}</strong></td>
                    <td><span class="badge badge-${orc.status === 'aprovado' ? 'success' : orc.status === 'pendente' ? 'warning' : 'danger'}">${orc.status || 'pendente'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="visualizarOrcamento('${orc._id}')">Ver</button>
                        <button class="btn btn-sm btn-success" onclick="gerarPDFOrcamento('${orc._id}')">PDF</button>
                    </td>
                </tr>
            `).join('');
        }

        // ========================================
        // ORÇAMENTOS
        // ========================================
        async function loadOrcamentos() {
            try {
                const response = await fetch(`${API_URL}/api/orcamentos`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    renderOrcamentosTable('orcamentosTable', data.orcamentos);
                }
            } catch (error) {
                console.error('Erro ao carregar orçamentos:', error);
            }
        }

        async function abrirNovoOrcamento() {
            // Carregar clientes e profissionais
            await Promise.all([
                loadAllClientes(),
                loadAllServicos(),
                loadAllProdutos(),
                loadAllProfissionais()
            ]);

            // Preencher select de profissionais
            const profSelect = document.getElementById('orcProfissional');
            const assistSelect = document.getElementById('orcAssistente');

            profSelect.innerHTML = '<option value="">Selecione...</option>' +
                allProfissionais.map(p => `<option value="${p._id}">${p.nome} - ${p.comissao}%</option>`).join('');

            assistSelect.innerHTML = '<option value="">Nenhum</option>' +
                allProfissionais.map(p => `<option value="${p._id}">${p.nome} - ${p.comissao}%</option>`).join('');

            // Limpar formulário
            orcamentoItems = [];
            document.getElementById('orcClienteCPF').value = '';
            document.getElementById('orcClienteNome').value = '';
            document.getElementById('orcDescontoGlobal').value = '0';
            document.getElementById('orcamentoItems').innerHTML = '';
            document.getElementById('orcTotal').textContent = 'R$ 0,00';

            openModal('novoOrcamentoModal');
        }

        async function buscarClientePorCPF(cpf) {
            if (cpf.length < 3) {
                document.getElementById('clienteAutocomplete').classList.remove('active');
                return;
            }

            const filtered = allClientes.filter(c =>
                c.cpf?.includes(cpf) || c.nome?.toLowerCase().includes(cpf.toLowerCase())
            );

            const autocomplete = document.getElementById('clienteAutocomplete');

            if (filtered.length > 0) {
                autocomplete.innerHTML = filtered.map(c => `
                    <div class="autocomplete-item" onclick="selecionarCliente('${c._id}')">
                        <div><strong>${c.nome}</strong></div>
                        <div style="font-size: 12px; color: var(--text-secondary);">CPF: ${c.cpf}</div>
                    </div>
                `).join('');
                autocomplete.classList.add('active');
            } else {
                autocomplete.classList.remove('active');
            }
        }

        function selecionarCliente(clienteId) {
            const cliente = allClientes.find(c => c._id === clienteId);
            if (cliente) {
                document.getElementById('orcClienteCPF').value = cliente.cpf;
                document.getElementById('orcClienteNome').value = cliente.nome;
                document.getElementById('clienteAutocomplete').classList.remove('active');
            }
        }

        async function buscarItens(query) {
            if (query.length < 2) {
                document.getElementById('itemAutocomplete').classList.remove('active');
                return;
            }

            const queryLower = query.toLowerCase();

            // Buscar serviços
            const servicosFiltrados = allServicos.filter(s =>
                s.nome?.toLowerCase().includes(queryLower)
            );

            // Buscar produtos
            const produtosFiltrados = allProdutos.filter(p =>
                p.nome?.toLowerCase().includes(queryLower) ||
                p.sku?.toLowerCase().includes(queryLower)
            );

            const autocomplete = document.getElementById('itemAutocomplete');

            let html = '';

            if (servicosFiltrados.length > 0) {
                html += servicosFiltrados.map(s => `
                    <div class="autocomplete-item" onclick="adicionarItemAoOrcamento('servico', '${s._id}')">
                        <div class="search-category">Serviço</div>
                        <div><strong>${s.nome}</strong></div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${s.categoria || '-'}</div>
                    </div>
                `).join('');
            }

            if (produtosFiltrados.length > 0) {
                html += produtosFiltrados.map(p => `
                    <div class="autocomplete-item" onclick="adicionarItemAoOrcamento('produto', '${p._id}')">
                        <div class="search-category">Produto</div>
                        <div><strong>${p.nome}</strong></div>
                        <div style="font-size: 12px; color: var(--text-secondary);">R$ ${(p.preco || 0).toFixed(2)} - Estoque: ${p.estoque || 0}</div>
                    </div>
                `).join('');
            }

            if (html) {
                autocomplete.innerHTML = html;
                autocomplete.classList.add('active');
            } else {
                autocomplete.classList.remove('active');
            }
        }

        function adicionarItemAoOrcamento(tipo, id) {
            let item;

            if (tipo === 'servico') {
                const servico = allServicos.find(s => s._id === id);
                if (!servico) return;

                item = {
                    tipo: 'servico',
                    id: servico._id,
                    nome: servico.nome,
                    tamanhos: servico.tamanhos || {},
                    tamanho: 'M',
                    quantidade: 1,
                    valor_unitario: servico.tamanhos?.M || 0,
                    desconto: 0
                };
            } else {
                const produto = allProdutos.find(p => p._id === id);
                if (!produto) return;

                item = {
                    tipo: 'produto',
                    id: produto._id,
                    nome: produto.nome,
                    quantidade: 1,
                    valor_unitario: produto.preco || 0,
                    desconto: 0
                };
            }

            orcamentoItems.push(item);
            renderOrcamentoItems();
            calcularTotalOrcamento();

            // Limpar busca
            document.getElementById('itemSearch').value = '';
            document.getElementById('itemAutocomplete').classList.remove('active');
        }

        function adicionarItemManual() {
            const item = {
                tipo: 'manual',
                nome: '',
                quantidade: 1,
                valor_unitario: 0,
                desconto: 0
            };

            orcamentoItems.push(item);
            renderOrcamentoItems();
        }

        function renderOrcamentoItems() {
            const container = document.getElementById('orcamentoItems');

            if (orcamentoItems.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">Nenhum item adicionado</p>';
                return;
            }

            container.innerHTML = orcamentoItems.map((item, index) => `
                <div class="item-row">
                    <input type="text" value="${item.nome}" placeholder="Nome do item" onchange="updateItem(${index}, 'nome', this.value)">
                    ${item.tipo === 'servico' ? `
                        <select onchange="updateItem(${index}, 'tamanho', this.value); updateItemTamanhoPreco(${index}, this.value)">
                            <option value="PP" ${item.tamanho === 'PP' ? 'selected' : ''}>PP - R$ ${(item.tamanhos?.PP || 0).toFixed(2)}</option>
                            <option value="P" ${item.tamanho === 'P' ? 'selected' : ''}>P - R$ ${(item.tamanhos?.P || 0).toFixed(2)}</option>
                            <option value="M" ${item.tamanho === 'M' ? 'selected' : ''}>M - R$ ${(item.tamanhos?.M || 0).toFixed(2)}</option>
                            <option value="G" ${item.tamanho === 'G' ? 'selected' : ''}>G - R$ ${(item.tamanhos?.G || 0).toFixed(2)}</option>
                            <option value="GG" ${item.tamanho === 'GG' ? 'selected' : ''}>GG - R$ ${(item.tamanhos?.GG || 0).toFixed(2)}</option>
                        </select>
                    ` : '<div></div>'}
                    <input type="number" value="${item.quantidade}" min="1" onchange="updateItem(${index}, 'quantidade', this.value)">
                    <input type="number" value="${item.valor_unitario}" step="0.01" onchange="updateItem(${index}, 'valor_unitario', this.value)">
                    <input type="number" value="${item.desconto}" min="0" max="100" placeholder="%" onchange="updateItem(${index}, 'desconto', this.value)">
                    <button class="btn-remove" onclick="removerItem(${index})">×</button>
                </div>
            `).join('');
        }

        function updateItem(index, field, value) {
            orcamentoItems[index][field] = value;
            calcularTotalOrcamento();
        }

        function updateItemTamanhoPreco(index, tamanho) {
            const item = orcamentoItems[index];
            if (item.tipo === 'servico' && item.tamanhos) {
                item.valor_unitario = item.tamanhos[tamanho] || 0;
                renderOrcamentoItems();
                calcularTotalOrcamento();
            }
        }

        function removerItem(index) {
            orcamentoItems.splice(index, 1);
            renderOrcamentoItems();
            calcularTotalOrcamento();
        }

        function calcularTotalOrcamento() {
            let subtotal = 0;

            orcamentoItems.forEach(item => {
                const quantidade = parseFloat(item.quantidade) || 0;
                const valorUnitario = parseFloat(item.valor_unitario) || 0;
                const desconto = parseFloat(item.desconto) || 0;

                const valorItem = quantidade * valorUnitario;
                const valorComDesconto = valorItem * (1 - desconto / 100);

                subtotal += valorComDesconto;
            });

            const descontoGlobal = parseFloat(document.getElementById('orcDescontoGlobal').value) || 0;
            const total = subtotal * (1 - descontoGlobal / 100);

            document.getElementById('orcTotal').textContent = `R$ ${total.toFixed(2)}`;

            // Calcular comissões
            const profSelect = document.getElementById('orcProfissional');
            const assistSelect = document.getElementById('orcAssistente');

            let comissaoProfissional = 0;
            let comissaoAssistente = 0;

            if (profSelect.value) {
                const prof = allProfissionais.find(p => p._id === profSelect.value);
                if (prof) {
                    comissaoProfissional = total * (parseFloat(prof.comissao) || 0) / 100;
                }
            }

            if (assistSelect.value && comissaoProfissional > 0) {
                const assist = allProfissionais.find(p => p._id === assistSelect.value);
                if (assist) {
                    comissaoAssistente = comissaoProfissional * (parseFloat(assist.comissao) || 0) / 100;
                }
            }

            document.getElementById('orcComissaoProfissional').textContent = `R$ ${comissaoProfissional.toFixed(2)}`;
            document.getElementById('orcComissaoAssistente').textContent = `R$ ${comissaoAssistente.toFixed(2)}`;
        }

        async function salvarOrcamento() {
            const clienteCPF = document.getElementById('orcClienteCPF').value;
            const clienteNome = document.getElementById('orcClienteNome').value;
            const profissionalId = document.getElementById('orcProfissional').value;
            const assistenteId = document.getElementById('orcAssistente').value;
            const descontoGlobal = parseFloat(document.getElementById('orcDescontoGlobal').value) || 0;
            const formaPagamento = document.getElementById('orcFormaPagamento').value;

            if (!clienteCPF || !clienteNome) {
                alert('Por favor, selecione um cliente');
                return;
            }

            if (!profissionalId) {
                alert('Por favor, selecione um profissional');
                return;
            }

            if (orcamentoItems.length === 0) {
                alert('Adicione pelo menos um item ao orçamento');
                return;
            }

            showLoading();

            try {
                const orcamento = {
                    cliente_cpf: clienteCPF,
                    cliente_nome: clienteNome,
                    profissional_id: profissionalId,
                    assistente_id: assistenteId || null,
                    itens: orcamentoItems.map(item => ({
                        tipo: item.tipo,
                        nome: item.nome,
                        tamanho: item.tamanho || null,
                        quantidade: parseFloat(item.quantidade),
                        valor_unitario: parseFloat(item.valor_unitario),
                        desconto_item: parseFloat(item.desconto) || 0
                    })),
                    desconto_global: descontoGlobal,
                    forma_pagamento: formaPagamento
                };

                const response = await fetch(`${API_URL}/api/orcamentos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(orcamento)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Orçamento salvo com sucesso!');
                    closeModal('novoOrcamentoModal');
                    await loadOrcamentos();
                } else {
                    alert(data.message || 'Erro ao salvar orçamento');
                }
            } catch (error) {
                console.error('Erro ao salvar orçamento:', error);
                alert('Erro ao salvar orçamento');
            } finally {
                hideLoading();
            }
        }

        async function gerarPDFOrcamento(id) {
            showLoading();
            try {
                window.open(`${API_URL}/api/orcamentos/${id}/pdf`, '_blank');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // CLIENTES
        // ========================================
        async function loadClientes() {
            try {
                const response = await fetch(`${API_URL}/api/clientes`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    allClientes = data.clientes;
                    renderClientesTable(data.clientes);
                }
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }

        async function loadAllClientes() {
            if (allClientes.length === 0) {
                await loadClientes();
            }
        }

        function renderClientesTable(clientes) {
            const tbody = document.getElementById('clientesTable');

            if (!clientes || clientes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum cliente encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = clientes.map(c => `
                <tr>
                    <td><strong>${c.nome || '-'}</strong></td>
                    <td>${c.cpf || '-'}</td>
                    <td>${c.telefone || '-'}</td>
                    <td>${c.email || '-'}</td>
                    <td>${c.cidade || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editarCliente('${c._id}')">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="excluirCliente('${c._id}')">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        async function salvarCliente() {
            const cliente = {
                nome: document.getElementById('clienteNome').value,
                cpf: document.getElementById('clienteCPF').value,
                email: document.getElementById('clienteEmail').value,
                telefone: document.getElementById('clienteTelefone').value,
                cep: document.getElementById('clienteCEP').value,
                cidade: document.getElementById('clienteCidade').value,
                endereco: document.getElementById('clienteEndereco').value
            };

            if (!cliente.nome || !cliente.cpf) {
                alert('Nome e CPF são obrigatórios');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/clientes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(cliente)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Cliente salvo com sucesso!');
                    closeModal('novoClienteModal');
                    await loadClientes();
                    // Limpar formulário
                    document.getElementById('clienteNome').value = '';
                    document.getElementById('clienteCPF').value = '';
                    document.getElementById('clienteEmail').value = '';
                    document.getElementById('clienteTelefone').value = '';
                    document.getElementById('clienteCEP').value = '';
                    document.getElementById('clienteCidade').value = '';
                    document.getElementById('clienteEndereco').value = '';
                } else {
                    alert(data.message || 'Erro ao salvar cliente');
                }
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
                alert('Erro ao salvar cliente');
            } finally {
                hideLoading();
            }
        }

        async function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');

            if (cep.length !== 8) return;

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();

                if (!data.erro) {
                    document.getElementById('clienteEndereco').value = `${data.logradouro}, ${data.bairro}`;
                    document.getElementById('clienteCidade').value = `${data.localidade} - ${data.uf}`;
                }
            } catch (error) {
                console.error('Erro ao buscar CEP:', error);
            }
        }

        async function excluirCliente(id) {
            if (!confirm('Deseja realmente excluir este cliente?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/clientes/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('Cliente excluído com sucesso!');
                    await loadClientes();
                } else {
                    alert(data.message || 'Erro ao excluir cliente');
                }
            } catch (error) {
                console.error('Erro ao excluir cliente:', error);
                alert('Erro ao excluir cliente');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // SERVIÇOS
        // ========================================
        async function loadServicos() {
            try {
                const response = await fetch(`${API_URL}/api/servicos`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    allServicos = data.servicos;
                    renderServicosTable(data.servicos);
                }
            } catch (error) {
                console.error('Erro ao carregar serviços:', error);
            }
        }

        async function loadAllServicos() {
            if (allServicos.length === 0) {
                await loadServicos();
            }
        }

        function renderServicosTable(servicos) {
            const tbody = document.getElementById('servicosTable');

            if (!servicos || servicos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum serviço encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = servicos.map(s => `
                <tr>
                    <td><strong>${s.nome || '-'}</strong></td>
                    <td>${s.categoria || '-'}</td>
                    <td>R$ ${(s.tamanhos?.PP || 0).toFixed(2)}</td>
                    <td>R$ ${(s.tamanhos?.P || 0).toFixed(2)}</td>
                    <td>R$ ${(s.tamanhos?.M || 0).toFixed(2)}</td>
                    <td>R$ ${(s.tamanhos?.G || 0).toFixed(2)}</td>
                    <td>R$ ${(s.tamanhos?.GG || 0).toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editarServico('${s._id}')">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="excluirServico('${s._id}')">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        async function salvarServico() {
            const servico = {
                nome: document.getElementById('servicoNome').value,
                categoria: document.getElementById('servicoCategoria').value,
                tamanhos: {
                    PP: parseFloat(document.getElementById('servicoPP').value) || 0,
                    P: parseFloat(document.getElementById('servicoP').value) || 0,
                    M: parseFloat(document.getElementById('servicoM').value) || 0,
                    G: parseFloat(document.getElementById('servicoG').value) || 0,
                    GG: parseFloat(document.getElementById('servicoGG').value) || 0
                }
            };

            if (!servico.nome) {
                alert('Nome do serviço é obrigatório');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/servicos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(servico)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Serviço salvo com sucesso!');
                    closeModal('novoServicoModal');
                    await loadServicos();
                    // Limpar formulário
                    document.getElementById('servicoNome').value = '';
                    document.getElementById('servicoCategoria').value = '';
                    document.getElementById('servicoPP').value = '';
                    document.getElementById('servicoP').value = '';
                    document.getElementById('servicoM').value = '';
                    document.getElementById('servicoG').value = '';
                    document.getElementById('servicoGG').value = '';
                } else {
                    alert(data.message || 'Erro ao salvar serviço');
                }
            } catch (error) {
                console.error('Erro ao salvar serviço:', error);
                alert('Erro ao salvar serviço');
            } finally {
                hideLoading();
            }
        }

        async function importarServicos(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/servicos/importar`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    alert(`${data.count} serviços importados com sucesso!`);
                    closeModal('importarServicosModal');
                    await loadServicos();
                } else {
                    alert(data.message || 'Erro ao importar serviços');
                }
            } catch (error) {
                console.error('Erro ao importar serviços:', error);
                alert('Erro ao importar serviços');
            } finally {
                hideLoading();
            }
        }

        async function excluirServico(id) {
            if (!confirm('Deseja realmente excluir este serviço?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/servicos/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('Serviço excluído com sucesso!');
                    await loadServicos();
                } else {
                    alert(data.message || 'Erro ao excluir serviço');
                }
            } catch (error) {
                console.error('Erro ao excluir serviço:', error);
                alert('Erro ao excluir serviço');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // PRODUTOS
        // ========================================
        async function loadProdutos() {
            try {
                const response = await fetch(`${API_URL}/api/produtos`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    allProdutos = data.produtos;
                    renderProdutosTable(data.produtos);
                }
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
            }
        }

        async function loadAllProdutos() {
            if (allProdutos.length === 0) {
                await loadProdutos();
            }
        }

        function renderProdutosTable(produtos) {
            const tbody = document.getElementById('produtosTable');

            if (!produtos || produtos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum produto encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = produtos.map(p => `
                <tr>
                    <td><strong>${p.sku || '-'}</strong></td>
                    <td>${p.nome || '-'}</td>
                    <td>${p.marca || '-'}</td>
                    <td>${p.categoria || '-'}</td>
                    <td><strong>R$ ${(p.preco || 0).toFixed(2)}</strong></td>
                    <td><span class="badge ${p.estoque > 10 ? 'badge-success' : p.estoque > 0 ? 'badge-warning' : 'badge-danger'}">${p.estoque || 0}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editarProduto('${p._id}')">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="excluirProduto('${p._id}')">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        async function salvarProduto() {
            const produto = {
                sku: document.getElementById('produtoSKU').value,
                nome: document.getElementById('produtoNome').value,
                marca: document.getElementById('produtoMarca').value,
                categoria: document.getElementById('produtoCategoria').value,
                preco: parseFloat(document.getElementById('produtoPreco').value) || 0,
                estoque: parseInt(document.getElementById('produtoEstoque').value) || 0
            };

            if (!produto.sku || !produto.nome) {
                alert('SKU e Nome são obrigatórios');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/produtos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(produto)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Produto salvo com sucesso!');
                    closeModal('novoProdutoModal');
                    await loadProdutos();
                    // Limpar formulário
                    document.getElementById('produtoSKU').value = '';
                    document.getElementById('produtoNome').value = '';
                    document.getElementById('produtoMarca').value = '';
                    document.getElementById('produtoCategoria').value = '';
                    document.getElementById('produtoPreco').value = '';
                    document.getElementById('produtoEstoque').value = '0';
                } else {
                    alert(data.message || 'Erro ao salvar produto');
                }
            } catch (error) {
                console.error('Erro ao salvar produto:', error);
                alert('Erro ao salvar produto');
            } finally {
                hideLoading();
            }
        }

        async function excluirProduto(id) {
            if (!confirm('Deseja realmente excluir este produto?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/produtos/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('Produto excluído com sucesso!');
                    await loadProdutos();
                } else {
                    alert(data.message || 'Erro ao excluir produto');
                }
            } catch (error) {
                console.error('Erro ao excluir produto:', error);
                alert('Erro ao excluir produto');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // PROFISSIONAIS
        // ========================================
        async function loadProfissionais() {
            try {
                const response = await fetch(`${API_URL}/api/profissionais`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    allProfissionais = data.profissionais;
                    renderProfissionaisTable(data.profissionais);
                }
            } catch (error) {
                console.error('Erro ao carregar profissionais:', error);
            }
        }

        async function loadAllProfissionais() {
            if (allProfissionais.length === 0) {
                await loadProfissionais();
            }
        }

        function renderProfissionaisTable(profissionais) {
            const tbody = document.getElementById('profissionaisTable');

            if (!profissionais || profissionais.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum profissional encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = profissionais.map(p => `
                <tr>
                    <td>
                        ${p.foto ? `<img src="${p.foto}" alt="${p.nome}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : '<div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">' + (p.nome ? p.nome.charAt(0) : '?') + '</div>'}
                    </td>
                    <td><strong>${p.nome || '-'}</strong></td>
                    <td>${p.cpf || '-'}</td>
                    <td>${p.cargo || '-'}</td>
                    <td><strong>${(p.comissao || 0).toFixed(2)}%</strong></td>
                    <td>${p.assistente_de ? 'Sim' : 'Não'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editarProfissional('${p._id}')">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="excluirProfissional('${p._id}')">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        async function salvarProfissional() {
            const nome = document.getElementById('profissionalNome').value;
            const cpf = document.getElementById('profissionalCPF').value;
            const cargo = document.getElementById('profissionalCargo').value;
            const comissao = parseFloat(document.getElementById('profissionalComissao').value) || 0;
            const fotoFile = document.getElementById('profissionalFoto').files[0];

            if (!nome || !cpf) {
                alert('Nome e CPF são obrigatórios');
                return;
            }

            showLoading();

            try {
                const formData = new FormData();
                formData.append('nome', nome);
                formData.append('cpf', cpf);
                formData.append('cargo', cargo);
                formData.append('comissao', comissao);

                if (fotoFile) {
                    formData.append('foto', fotoFile);
                }

                const response = await fetch(`${API_URL}/api/profissionais`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    alert('Profissional salvo com sucesso!');
                    closeModal('novoProfissionalModal');
                    await loadProfissionais();
                    // Limpar formulário
                    document.getElementById('profissionalNome').value = '';
                    document.getElementById('profissionalCPF').value = '';
                    document.getElementById('profissionalCargo').value = '';
                    document.getElementById('profissionalComissao').value = '10';
                    document.getElementById('profissionalFoto').value = '';
                } else {
                    alert(data.message || 'Erro ao salvar profissional');
                }
            } catch (error) {
                console.error('Erro ao salvar profissional:', error);
                alert('Erro ao salvar profissional');
            } finally {
                hideLoading();
            }
        }

        async function excluirProfissional(id) {
            if (!confirm('Deseja realmente excluir este profissional?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/profissionais/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('Profissional excluído com sucesso!');
                    await loadProfissionais();
                } else {
                    alert(data.message || 'Erro ao excluir profissional');
                }
            } catch (error) {
                console.error('Erro ao excluir profissional:', error);
                alert('Erro ao excluir profissional');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // ESTOQUE
        // ========================================
        async function loadEstoque() {
            try {
                // Carregar produtos para o select
                await loadAllProdutos();

                const movSelect = document.getElementById('movProduto');
                movSelect.innerHTML = '<option value="">Selecione...</option>' +
                    allProdutos.map(p => `<option value="${p._id}">${p.nome} (${p.sku})</option>`).join('');

                // Carregar movimentações
                const response = await fetch(`${API_URL}/api/estoque/movimentacoes`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    renderEstoqueTable(data.movimentacoes);
                }
            } catch (error) {
                console.error('Erro ao carregar estoque:', error);
            }
        }

        function renderEstoqueTable(movimentacoes) {
            const tbody = document.getElementById('estoqueTable');

            if (!movimentacoes || movimentacoes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma movimentação encontrada</td></tr>';
                return;
            }

            tbody.innerHTML = movimentacoes.map(m => `
                <tr>
                    <td>${new Date(m.data).toLocaleString('pt-BR')}</td>
                    <td>
                        <strong>${m.produto_nome || '-'}</strong><br>
                        <small style="color: var(--text-secondary);">${m.produto_marca || ''}</small>
                    </td>
                    <td><span class="badge ${m.tipo === 'entrada' ? 'badge-success' : 'badge-danger'}">${m.tipo}</span></td>
                    <td><strong>${m.quantidade || 0}</strong></td>
                    <td>${m.responsavel || '-'}</td>
                    <td><span class="badge badge-${m.status === 'aprovado' ? 'success' : m.status === 'pendente' ? 'warning' : 'danger'}">${m.status || 'pendente'}</span></td>
                    <td>
                        ${m.status === 'pendente' ? `
                            <button class="btn btn-sm btn-success" onclick="aprovarMovimentacao('${m._id}')">✓</button>
                            <button class="btn btn-sm btn-danger" onclick="reprovarMovimentacao('${m._id}')">✗</button>
                        ` : '-'}
                    </td>
                </tr>
            `).join('');
        }

        async function salvarMovimentacao() {
            const movimentacao = {
                produto_id: document.getElementById('movProduto').value,
                tipo: document.getElementById('movTipo').value,
                quantidade: parseInt(document.getElementById('movQuantidade').value) || 0,
                responsavel: document.getElementById('movResponsavel').value,
                observacoes: document.getElementById('movObservacoes').value
            };

            if (!movimentacao.produto_id || !movimentacao.tipo || movimentacao.quantidade <= 0) {
                alert('Preencha todos os campos obrigatórios');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/estoque/movimentacoes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(movimentacao)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Movimentação registrada com sucesso!');
                    closeModal('novaMovimentacaoModal');
                    await loadEstoque();
                    // Limpar formulário
                    document.getElementById('movProduto').value = '';
                    document.getElementById('movTipo').value = 'entrada';
                    document.getElementById('movQuantidade').value = '';
                    document.getElementById('movResponsavel').value = '';
                    document.getElementById('movObservacoes').value = '';
                } else {
                    alert(data.message || 'Erro ao registrar movimentação');
                }
            } catch (error) {
                console.error('Erro ao salvar movimentação:', error);
                alert('Erro ao salvar movimentação');
            } finally {
                hideLoading();
            }
        }

        async function aprovarMovimentacao(id) {
            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/estoque/movimentacoes/${id}/aprovar`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    await loadEstoque();
                } else {
                    alert(data.message || 'Erro ao aprovar movimentação');
                }
            } catch (error) {
                console.error('Erro ao aprovar movimentação:', error);
                alert('Erro ao aprovar movimentação');
            } finally {
                hideLoading();
            }
        }

        async function reprovarMovimentacao(id) {
            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/estoque/movimentacoes/${id}/reprovar`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    await loadEstoque();
                } else {
                    alert(data.message || 'Erro ao reprovar movimentação');
                }
            } catch (error) {
                console.error('Erro ao reprovar movimentação:', error);
                alert('Erro ao reprovar movimentação');
            } finally {
                hideLoading();
            }
        }

        async function aprovarTodasMovimentacoes() {
            if (!confirm('Deseja aprovar todas as movimentações pendentes?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/estoque/movimentacoes/aprovar-todas`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert(`${data.count} movimentações aprovadas com sucesso!`);
                    await loadEstoque();
                } else {
                    alert(data.message || 'Erro ao aprovar movimentações');
                }
            } catch (error) {
                console.error('Erro ao aprovar movimentações:', error);
                alert('Erro ao aprovar movimentações');
            } finally {
                hideLoading();
            }
        }

        async function reprovarTodasMovimentacoes() {
            if (!confirm('Deseja reprovar todas as movimentações pendentes?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/estoque/movimentacoes/reprovar-todas`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert(`${data.count} movimentações reprovadas com sucesso!`);
                    await loadEstoque();
                } else {
                    alert(data.message || 'Erro ao reprovar movimentações');
                }
            } catch (error) {
                console.error('Erro ao reprovar movimentações:', error);
                alert('Erro ao reprovar movimentações');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // AGENDAMENTOS
        // ========================================
        async function loadAgendamentos() {
            try {
                // Carregar clientes e profissionais para os selects
                await Promise.all([
                    loadAllClientes(),
                    loadAllProfissionais()
                ]);

                const clienteSelect = document.getElementById('agendCliente');
                const profSelect = document.getElementById('agendProfissional');

                clienteSelect.innerHTML = '<option value="">Selecione...</option>' +
                    allClientes.map(c => `<option value="${c._id}">${c.nome}</option>`).join('');

                profSelect.innerHTML = '<option value="">Selecione...</option>' +
                    allProfissionais.map(p => `<option value="${p._id}">${p.nome}</option>`).join('');

                // Carregar agendamentos
                const response = await fetch(`${API_URL}/api/agendamentos`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    renderCalendar(data.agendamentos);
                }
            } catch (error) {
                console.error('Erro ao carregar agendamentos:', error);
            }
        }

        function renderCalendar(agendamentos) {
            const container = document.getElementById('calendarContainer');

            // Simples visualização de calendário
            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Horário</th>
                                <th>Cliente</th>
                                <th>Profissional</th>
                                <th>Serviço</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${agendamentos.length > 0 ? agendamentos.map(a => `
                                <tr>
                                    <td>${new Date(a.data).toLocaleDateString('pt-BR')}</td>
                                    <td>${a.horario || '-'}</td>
                                    <td>${a.cliente_nome || '-'}</td>
                                    <td>${a.profissional_nome || '-'}</td>
                                    <td>${a.descricao || '-'}</td>
                                    <td>
                                        <button class="btn btn-sm btn-danger" onclick="excluirAgendamento('${a._id}')">Cancelar</button>
                                    </td>
                                </tr>
                            `).join('') : '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum agendamento encontrado</td></tr>'}
                        </tbody>
                    </table>
                </div>
            `;
        }

        async function salvarAgendamento() {
            const agendamento = {
                cliente_id: document.getElementById('agendCliente').value,
                profissional_id: document.getElementById('agendProfissional').value,
                data: document.getElementById('agendData').value,
                horario: document.getElementById('agendHorario').value,
                descricao: document.getElementById('agendDescricao').value
            };

            if (!agendamento.cliente_id || !agendamento.profissional_id || !agendamento.data || !agendamento.horario) {
                alert('Preencha todos os campos obrigatórios');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/agendamentos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(agendamento)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Agendamento salvo com sucesso!');
                    closeModal('novoAgendamentoModal');
                    await loadAgendamentos();
                    // Limpar formulário
                    document.getElementById('agendCliente').value = '';
                    document.getElementById('agendProfissional').value = '';
                    document.getElementById('agendData').value = '';
                    document.getElementById('agendHorario').value = '';
                    document.getElementById('agendDescricao').value = '';
                } else {
                    alert(data.message || 'Erro ao salvar agendamento');
                }
            } catch (error) {
                console.error('Erro ao salvar agendamento:', error);
                alert('Erro ao salvar agendamento');
            } finally {
                hideLoading();
            }
        }

        async function excluirAgendamento(id) {
            if (!confirm('Deseja realmente cancelar este agendamento?')) return;

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/agendamentos/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('Agendamento cancelado com sucesso!');
                    await loadAgendamentos();
                } else {
                    alert(data.message || 'Erro ao cancelar agendamento');
                }
            } catch (error) {
                console.error('Erro ao cancelar agendamento:', error);
                alert('Erro ao cancelar agendamento');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // RELATÓRIOS
        // ========================================
        async function loadRelatorios() {
            // Carregar estatísticas
            try {
                const response = await fetch(`${API_URL}/api/relatorios/estatisticas`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    renderEstatisticas(data.stats);
                }
            } catch (error) {
                console.error('Erro ao carregar relatórios:', error);
            }
        }

        function renderEstatisticas(stats) {
            const container = document.getElementById('estatisticasContainer');

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-label">Total de Produtos</div>
                        <div class="stat-value">${stats.total_produtos || 0}</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">Valor Total em Estoque</div>
                        <div class="stat-value">R$ ${(stats.valor_estoque || 0).toFixed(2)}</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Produtos Abaixo do Mínimo</div>
                        <div class="stat-value">${stats.produtos_baixo_estoque || 0}</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-label">Produtos Sem Estoque</div>
                        <div class="stat-value">${stats.produtos_sem_estoque || 0}</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h4>Top 5 Produtos Mais Vendidos</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Quantidade Vendida</th>
                                    <th>Receita Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(stats.top_produtos || []).map(p => `
                                    <tr>
                                        <td><strong>${p.nome || '-'}</strong></td>
                                        <td>${p.quantidade || 0}</td>
                                        <td><strong>R$ ${(p.total || 0).toFixed(2)}</strong></td>
                                    </tr>
                                `).join('') || '<tr><td colspan="3" style="text-align: center; padding: 20px; color: var(--text-secondary);">Nenhum dado disponível</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        async function gerarRelatorioPDF() {
            const tipo = document.getElementById('relatorioTipo').value;
            const dataInicio = document.getElementById('relatorioDataInicio').value;
            const dataFim = document.getElementById('relatorioDataFim').value;

            if (!dataInicio || !dataFim) {
                alert('Por favor, selecione as datas');
                return;
            }

            showLoading();

            try {
                window.open(`${API_URL}/api/relatorios/pdf?tipo=${tipo}&data_inicio=${dataInicio}&data_fim=${dataFim}`, '_blank');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF');
            } finally {
                hideLoading();
            }
        }

        async function gerarRelatorioExcel() {
            const tipo = document.getElementById('relatorioTipo').value;
            const dataInicio = document.getElementById('relatorioDataInicio').value;
            const dataFim = document.getElementById('relatorioDataFim').value;

            if (!dataInicio || !dataFim) {
                alert('Por favor, selecione as datas');
                return;
            }

            showLoading();

            try {
                window.open(`${API_URL}/api/relatorios/excel?tipo=${tipo}&data_inicio=${dataInicio}&data_fim=${dataFim}`, '_blank');
            } catch (error) {
                console.error('Erro ao gerar Excel:', error);
                alert('Erro ao gerar Excel');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // CONFIGURAÇÕES
        // ========================================
        async function loadConfiguracoes() {
            // Carregar logo atual
            loadLogo();
        }

        async function loadLogo() {
            try {
                const response = await fetch(`${API_URL}/api/logo`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success && data.logo_url) {
                    // Atualizar logo na tela de login
                    document.getElementById('loginLogo').src = data.logo_url;
                    // Atualizar logo no sidebar
                    document.getElementById('sidebarLogo').src = data.logo_url;
                    // Mostrar preview nas configurações
                    if (document.getElementById('currentLogo')) {
                        document.getElementById('currentLogo').innerHTML = `
                            <img src="${data.logo_url}" alt="Logo atual" style="max-width: 200px; border-radius: 8px;">
                        `;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar logo:', error);
            }
        }

        async function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('logo', file);

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/logo/upload`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    alert('Logo atualizado com sucesso!');
                    await loadLogo();
                } else {
                    alert(data.message || 'Erro ao fazer upload do logo');
                }
            } catch (error) {
                console.error('Erro ao fazer upload do logo:', error);
                alert('Erro ao fazer upload do logo');
            } finally {
                hideLoading();
            }
        }

        async function fazerBackup() {
            showLoading();

            try {
                window.open(`${API_URL}/api/backup`, '_blank');
                alert('Backup iniciado! O download começará em breve.');
            } catch (error) {
                console.error('Erro ao fazer backup:', error);
                alert('Erro ao fazer backup');
            } finally {
                hideLoading();
            }
        }

        async function restaurarBackup(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!confirm('ATENÇÃO: Restaurar um backup irá SUBSTITUIR todos os dados atuais. Deseja continuar?')) {
                return;
            }

            const formData = new FormData();
            formData.append('backup', file);

            showLoading();

            try {
                const response = await fetch(`${API_URL}/api/backup/restore`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    alert('Backup restaurado com sucesso! A página será recarregada.');
                    window.location.reload();
                } else {
                    alert(data.message || 'Erro ao restaurar backup');
                }
            } catch (error) {
                console.error('Erro ao restaurar backup:', error);
                alert('Erro ao restaurar backup');
            } finally {
                hideLoading();
            }
        }

        function salvarPreferencias() {
            const autoApprove = document.getElementById('autoApprove').checked;
            const emailNotifications = document.getElementById('emailNotifications').checked;

            localStorage.setItem('preferences', JSON.stringify({
                autoApprove,
                emailNotifications
            }));

            alert('Preferências salvas com sucesso!');
        }

        // ========================================
        // BUSCA GLOBAL
        // ========================================
        let searchTimeout;

        async function handleGlobalSearch(query) {
            clearTimeout(searchTimeout);

            if (query.length < 2) {
                document.getElementById('searchResults').classList.remove('active');
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`${API_URL}/api/busca/global?q=${encodeURIComponent(query)}`, {
                        credentials: 'include'
                    });
                    const data = await response.json();

                    if (data.success) {
                        renderSearchResults(data.resultados);
                    }
                } catch (error) {
                    console.error('Erro na busca global:', error);
                }
            }, 300);
        }

        function renderSearchResults(resultados) {
            const container = document.getElementById('searchResults');

            let html = '';

            // Clientes
            if (resultados.clientes && resultados.clientes.length > 0) {
                html += resultados.clientes.map(c => `
                    <div class="search-result-item" onclick="irParaCliente('${c._id}')">
                        <div class="search-category">Cliente</div>
                        <div class="search-title">${c.nome}</div>
                        <div class="search-subtitle">CPF: ${c.cpf}</div>
                    </div>
                `).join('');
            }

            // Produtos
            if (resultados.produtos && resultados.produtos.length > 0) {
                html += resultados.produtos.map(p => `
                    <div class="search-result-item" onclick="irParaProduto('${p._id}')">
                        <div class="search-category">Produto</div>
                        <div class="search-title">${p.nome}</div>
                        <div class="search-subtitle">SKU: ${p.sku} - Estoque: ${p.estoque}</div>
                    </div>
                `).join('');
            }

            // Serviços
            if (resultados.servicos && resultados.servicos.length > 0) {
                html += resultados.servicos.map(s => `
                    <div class="search-result-item" onclick="irParaServico('${s._id}')">
                        <div class="search-category">Serviço</div>
                        <div class="search-title">${s.nome}</div>
                        <div class="search-subtitle">${s.categoria || '-'}</div>
                    </div>
                `).join('');
            }

            // Profissionais
            if (resultados.profissionais && resultados.profissionais.length > 0) {
                html += resultados.profissionais.map(p => `
                    <div class="search-result-item" onclick="irParaProfissional('${p._id}')">
                        <div class="search-category">Profissional</div>
                        <div class="search-title">${p.nome}</div>
                        <div class="search-subtitle">${p.cargo || '-'}</div>
                    </div>
                `).join('');
            }

            // Orçamentos
            if (resultados.orcamentos && resultados.orcamentos.length > 0) {
                html += resultados.orcamentos.map(o => `
                    <div class="search-result-item" onclick="visualizarOrcamento('${o._id}')">
                        <div class="search-category">Orçamento</div>
                        <div class="search-title">#${o.numero} - ${o.cliente_nome}</div>
                        <div class="search-subtitle">R$ ${(o.valor_total || 0).toFixed(2)}</div>
                    </div>
                `).join('');
            }

            if (html) {
                container.innerHTML = html;
                container.classList.add('active');
            } else {
                container.innerHTML = '<div class="search-result-item">Nenhum resultado encontrado</div>';
                container.classList.add('active');
            }
        }

        function irParaCliente(id) {
            navigateTo('clientes');
            document.getElementById('searchResults').classList.remove('active');
        }

        function irParaProduto(id) {
            navigateTo('produtos');
            document.getElementById('searchResults').classList.remove('active');
        }

        function irParaServico(id) {
            navigateTo('servicos');
            document.getElementById('searchResults').classList.remove('active');
        }

        function irParaProfissional(id) {
            navigateTo('profissionais');
            document.getElementById('searchResults').classList.remove('active');
        }

        // ========================================
        // UTILITÁRIOS
        // ========================================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');

            // Handlers especiais ao abrir modais
            if (modalId === 'novoOrcamentoModal') {
                abrirNovoOrcamento();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.className = `alert alert-${type} active`;
            container.textContent = message;

            setTimeout(() => {
                container.classList.remove('active');
            }, 5000);
        }

        function toggleTheme() {
            const html = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');

            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                themeToggle.textContent = '🌙';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Fechar modais e dropdowns ao clicar fora
        document.addEventListener('click', (e) => {
            // Fechar modals ao clicar no overlay
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }

            // Fechar autocompletes ao clicar fora
            if (!e.target.closest('.autocomplete-container') && !e.target.closest('.search-container')) {
                document.querySelectorAll('.autocomplete-results, .search-results').forEach(el => {
                    el.classList.remove('active');
                });
            }
        });

        // ========================================
        // INICIALIZAÇÃO
        // ========================================
        window.addEventListener('DOMContentLoaded', () => {
            // Carregar tema salvo
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').textContent = '☀️';
            }

            // Carregar preferências
            const savedPrefs = localStorage.getItem('preferences');
            if (savedPrefs) {
                const prefs = JSON.parse(savedPrefs);
                if (document.getElementById('autoApprove')) {
                    document.getElementById('autoApprove').checked = prefs.autoApprove || false;
                }
                if (document.getElementById('emailNotifications')) {
                    document.getElementById('emailNotifications').checked = prefs.emailNotifications || false;
                }
            }

            // Definir datas padrão para relatórios (último mês)
            const hoje = new Date();
            const mesPassado = new Date(hoje);
            mesPassado.setMonth(mesPassado.getMonth() - 1);

            if (document.getElementById('relatorioDataInicio')) {
                document.getElementById('relatorioDataInicio').value = mesPassado.toISOString().split('T')[0];
            }
            if (document.getElementById('relatorioDataFim')) {
                document.getElementById('relatorioDataFim').value = hoje.toISOString().split('T')[0];
            }
        });
    </script>
</body>
</html>